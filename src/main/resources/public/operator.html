<!DOCTYPE html>
<html><head><meta charset="utf-8"/><title>Operator dashboard</title>
    <style>body{font-family:sans-serif;max-width:800px;margin:30px auto}
    h2{margin-top:32px} table{border-collapse:collapse;width:100%}
    td,th{border:1px solid #ccc;padding:4px}</style></head><body>
<h1>Transport operator dashboard</h1>
<div id="who"></div>

<h2>All tickets</h2><table id="tickets"></table>
<h2>Payments</h2><table id="payments"></table>

<script>
    const token=localStorage.getItem('jwt');
    if(!token) location.href='/login.html';

    const hdrs={Authorization:'Bearer '+token};
    fetch('/api/me',{headers:hdrs}).then(r=>r.json()).then(me=>{
        if(me.role!=='OPERATOR'){alert('not operator');location.href='/login.html';return;}
        document.getElementById('who').textContent="UID: "+me.uid;
        load('/tickets/all','tickets',t=>[t.ticketID,t.ticketType,t.price]);
        load('/payments','payments',p=>[p.transactionID,p.amount,p.status]);
    });
    function load(ep,id,map){
        fetch(ep,{headers:hdrs}).then(r=>r.json()).then(a=>{
            const tbl=document.getElementById(id); tbl.innerHTML='';
            a.forEach(o=>{const tr=tbl.insertRow(); map(o).forEach(v=>tr.insertCell().textContent=v);});
        });
    }
</script>
</body></html>
