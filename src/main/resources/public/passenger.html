<!DOCTYPE html>
<html><head><meta charset="utf-8"/><title>Passenger dashboard</title>
    <style>body{font-family:sans-serif;max-width:600px;margin:30px auto}
    h2{margin-top:32px} table{border-collapse:collapse;width:100%}
    td,th{border:1px solid #ccc;padding:4px}</style></head><body>
<h1>Passenger dashboard</h1>
<div id="who"></div>

<h2>My tickets</h2><table id="tickets"></table>
<h2>My journey plans</h2><table id="plans"></table>

<script>
    const token = localStorage.getItem('jwt');
    if(!token) location.href='/login.html';

    const hdrs = {Authorization:'Bearer '+token};
    fetch('/api/me', {headers:hdrs}).then(r=>r.json()).then(me=>{
        document.getElementById('who').textContent = "UID: "+me.uid;
        load('/tickets',       'tickets', t=>[t.ticketID,t.ticketType,t.issueDate]);
        load('/plans',         'plans',   p=>[p.planID,p.routeDetails,p.estimatedTravelTime]);
    });

    function load(ep, tblId, rowMap){
        fetch(ep,{headers:hdrs}).then(r=>r.json()).then(arr=>{
            const tbl=document.getElementById(tblId);
            tbl.innerHTML='';
            arr.forEach(o=>{
                const tr=tbl.insertRow(); rowMap(o).forEach(
                    v=>tr.insertCell().textContent=v);
            });
        });
    }
</script>
</body></html>
